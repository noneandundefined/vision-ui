#!/bin/bash

set -e

echo "ğŸ“¦ Started publish to npm..."

if [ ! -f "package.json" ]; then
    echo "âŒ Mistake: package.json not found!"
    exit 1
fi

if ! npm whoami > /dev/null 2>&1; then
    echo "ğŸ”‘ login npm..."
    npm login
fi

echo "ğŸ§¹ Deleting the old build..."
rm -rf dist node_modules

if ! command -v pnpm &> /dev/null; then
    echo "ğŸš€ Installing pnpm..."
    npm i -g pnpm
fi

echo "ğŸ“¥ Installing dependencies..."
pnpm install

echo "âš¡ï¸ TypeScript Compilation..."
pnpm build

echo "ğŸš€ Publish to npm..."
npm publish --access public

echo "âœ… Publication completed!"
